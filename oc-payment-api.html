<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../oc-core-utils/oc-core-utils.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<dom-module id="oc-payment-api">
  <template>
      <iron-ajax id="makeFlashPayment"></iron-ajax>
      <iron-ajax id="confirmFlashPayment"></iron-ajax>
  </template>

  <script>
    /**
     * `oc-payment-api`
     * Ordercloud API for payments
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class OcPaymentApi extends Ordercloud.ApiMixin(Polymer.Element) {
      static get is() { return 'oc-payment-api'; }
      static get properties() {return { };}

      /**
       * Make flash payment
       *
       * @param paymentData.fromAccountId the account ot pay from
       * @param paymentData.ammount the ammount to pay in Rands
       *
       * @return {Promise}
       */
      makePayment(paymentData) {
          this.$.makeFlashPayment.url = this._generateUrl('transactions/payment');
          this.$.makeFlashPayment.method = "POST";
          this.$.makeFlashPayment.contentType = "application/json";
          this.$.makeFlashPayment.body = paymentData;
          return this._generateRequest(this.$.makeFlashPayment);
      }

      /**
       * Flash confirmation OTP
       *
       * @param paymentData.otp the otp to confirm on the transaction
       *
       * @return {Promise}
       */
      confirmPayment(paymentId, paymentData) {
          this.$.confirmFlashPayment.url = this._generateUrl('transactions/' + paymentId +'/confirm');
          this.$.confirmFlashPayment.method = "POST";
          this.$.confirmFlashPayment.contentType = "application/json";
          this.$.confirmFlashPayment.body = paymentData;
          return this._generateRequest(this.$.confirmFlashPayment);
      }
    }

    window.customElements.define(OcPaymentApi.is, OcPaymentApi);
  </script>
</dom-module>
